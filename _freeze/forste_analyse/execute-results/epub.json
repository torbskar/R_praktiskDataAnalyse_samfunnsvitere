{
  "hash": "dcdaca40ed0b1240df1be20ef83981d4",
  "result": {
    "engine": "knitr",
    "markdown": "# Din første analyse\n\n\n\n\n\n\n\n\n::: {.cell}\n\n:::\n\n\n\n\n\n\n\n\nI de forrige kapitlene har du installert R og RStudio, og fått en kort introduksjon til grunnleggende konsepter. Nå skal vi gjøre noe annerledes: vi skal kjøre gjennom en hel analyse fra start til mål -- lese inn ekte data og lage ekte figurer.\n\nMålet med dette kapittelet er at du skal oppleve at R faktisk *fungerer*, og at du kan produsere noe meningsfullt med bare noen få linjer kode. Ikke bekymre deg om du ikke forstår alle detaljene. Hvert tema forklares grundig i senere kapitler. Her handler det om å følge med, kjøre koden, og se resultatene.\n\nDataene vi bruker er kriminalitetsstatistikk fra SSB (Statistisk sentralbyrå), hentet fra [tabell 09415](https://www.ssb.no/statbank/table/09415). De viser siktede for lovbrudd per 1000 innbyggere, fordelt på alder.\n\nÅpne RStudio, sørg for at prosjektet ditt er aktivt (se kapittelet om installering), og opprett et nytt R-script (File → New File → R Script). Skriv koden inn i scriptet og kjør den linje for linje med **Ctrl + Enter**.\n\n## Laste pakker\n\nFør vi kan bruke spesialiserte funksjoner, må vi laste pakkene som inneholder dem. Hvis du ikke allerede har installert disse pakkene, gjør det først:\n\n\n\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Installer pakker (trenger bare gjøres én gang)\ninstall.packages(c(\"tidyverse\", \"readxl\"))\n```\n:::\n\n\n\n\n\n\n\n\nDeretter laster vi pakkene. Dette må gjøres hver gang du starter R på nytt:\n\n\n\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Laste pakker (gjøres hver gang du starter R)\nlibrary(tidyverse)   # Pakke for datahåndtering og grafikk\nlibrary(readxl)      # Pakke for å lese Excel-filer\n```\n:::\n\n\n\n\n\n\n\n\nFunksjonen `install.packages()` laster ned pakken til maskinen din, mens `library()` aktiverer den i den gjeldende R-sesjonen. Se kapittelet om introduksjon til R for mer om pakker.\n\n## Lese inn data\n\nNå leser vi inn en Excel-fil med kriminalitetsdata. Funksjonen `read_excel()` leser filen, og `<-` lagrer resultatet i et objekt vi kaller `krim`:\n\n\n\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Lese inn en Excel-fil med kriminalitetsdata fra SSB\n# read_excel() leser filen, <- lagrer resultatet i objektet \"krim\"\nkrim <- read_excel(\"data/SSB_09415_enkel2024.xlsx\")\n```\n:::\n\n\n\n\n\n\n\n\nNå ligger dataene i objektet `krim`. Filstien `\"data/SSB_09415_enkel2024.xlsx\"` betyr at filen ligger i en undermappe som heter `data` i prosjektmappen din. Innlesning av data dekkes grundig i Del II.\n\n## Ta en titt på dataene\n\nFør vi lager figurer bør vi sjekke at dataene ser fornuftige ut. To nyttige funksjoner for dette er `head()` og `glimpse()`:\n\n\n\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Se på de første radene i datasettet\n# head() viser de 6 første observasjonene\nhead(krim)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n# A tibble: 6 × 2\n  alder  vold\n  <dbl> <dbl>\n1     5  0.02\n2     6  0.05\n3     7  0.03\n4     8  0.19\n5     9  0.27\n6    10  0.63\n```\n\n\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\n# En annen måte å se på dataene\n# glimpse() viser variabelnavn, datatype og de første verdiene\nglimpse(krim)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nRows: 45\nColumns: 2\n$ alder <dbl> 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20, 21, 2…\n$ vold  <dbl> 0.02, 0.05, 0.03, 0.19, 0.27, 0.63, 1.18, 2.80, 6.36, 9.41, 5.36…\n```\n\n\n:::\n:::\n\n\n\n\n\n\n\n\nVi ser at datasettet har to kolonner: `alder` (gjerningspersonens alder) og `vold` (antall siktede for vold per 1000 innbyggere i den aldersgruppen, for 2024). La oss se hva disse tallene viser grafisk.\n\n## Din første figur\n\nNå lager vi vår første figur. Vi bruker `ggplot`, som er det standard systemet for grafikk i R. Prinsippet er lagvis oppbygging: du starter med et grunnlag og legger til nye elementer ett om gangen. La oss se det steg for steg.\n\n### Steg 1: Bare en linje\n\n\n\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Start et plot: alder på x-aksen, vold på y-aksen\n# geom_line() tegner en linje mellom datapunktene\nggplot(krim, aes(x = alder, y = vold)) +\n  geom_line()\n```\n\n::: {.cell-output-display}\n![](forste_analyse_files/figure-epub/unnamed-chunk-7-1.png)\n:::\n:::\n\n\n\n\n\n\n\n\nHer skjer tre ting: `ggplot(krim, ...)` sier \"bruk datasettet `krim`\". Inni `aes()` (kort for *aesthetics*) angir vi at `alder` skal på x-aksen og `vold` på y-aksen. Til slutt sier `geom_line()` at dataene skal vises som en linje. Resultatet er et minimalt, men fungerende plot.\n\n### Steg 2: Legg til punkter\n\n\n\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Legg til geom_point() for å vise hvert datapunkt\nggplot(krim, aes(x = alder, y = vold)) +\n  geom_line() +\n  geom_point()\n```\n\n::: {.cell-output-display}\n![](forste_analyse_files/figure-epub/unnamed-chunk-8-1.png)\n:::\n:::\n\n\n\n\n\n\n\n\nVi legger til `geom_point()` med `+`. Nå ser vi hvert enkelt datapunkt i tillegg til linjen. `+` i ggplot betyr \"legg til et nytt lag\".\n\n### Steg 3: Legg til tittel\n\n\n\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Legg til en overskrift med ggtitle()\nggplot(krim, aes(x = alder, y = vold)) +\n  geom_line() +\n  geom_point() +\n  ggtitle(\"Voldslovbrudd etter alder\")\n```\n\n::: {.cell-output-display}\n![](forste_analyse_files/figure-epub/unnamed-chunk-9-1.png)\n:::\n:::\n\n\n\n\n\n\n\n\n`ggtitle()` legger til en overskrift på figuren. Enda et lag oppå de forrige.\n\n### Steg 4: Legg til akselabels og kilde\n\n\n\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# labs() styrer akseetiketter, undertittel og kildeangivelse\nggplot(krim, aes(x = alder, y = vold)) +\n  geom_line() +\n  geom_point() +\n  ggtitle(\"Voldslovbrudd etter alder\",\n          subtitle = \"Siktede per 1000 innbyggere, 2024\") +\n  labs(x = \"Alder\",\n       y = \"Siktede per 1000 innbyggere\",\n       caption = \"Kilde: SSB, tabell 09415\")\n```\n\n::: {.cell-output-display}\n![](forste_analyse_files/figure-epub/unnamed-chunk-10-1.png)\n:::\n:::\n\n\n\n\n\n\n\n\n`labs()` lar deg sette egne etiketter på aksene. `subtitle` legger til en undertekst under tittelen, og `caption` legger til en kildeangivelse nederst.\n\n### Steg 5: Endre tema og lagre i et objekt\n\n\n\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# theme_minimal() gir et renere utseende\n# Vi lagrer figuren i objektet p1 slik at vi kan bruke den igjen\np1 <- ggplot(krim, aes(x = alder, y = vold)) +\n  geom_line(linewidth = 1) +\n  geom_point() +\n  ggtitle(\"Voldslovbrudd etter alder\",\n          subtitle = \"Siktede per 1000 innbyggere, 2024\") +\n  labs(x = \"Alder\",\n       y = \"Siktede per 1000 innbyggere\",\n       caption = \"Kilde: SSB, tabell 09415\") +\n  theme_minimal()\n\n# Vis figuren\np1\n```\n\n::: {.cell-output-display}\n![](forste_analyse_files/figure-epub/unnamed-chunk-11-1.png)\n:::\n:::\n\n\n\n\n\n\n\n\n`theme_minimal()` endrer det visuelle temaet til et renere design uten grå bakgrunn. `linewidth = 1` gjør linjen litt tykkere. Ved å skrive `p1 <- ggplot(...)` lagrer vi hele figuren i et objekt, slik at vi kan vise den igjen ved å skrive `p1`.\n\nLegg merke til hva figuren forteller: voldskriminalitet stiger bratt i tenårene, topper rundt 18--20 år, og faller deretter jevnt. Du har nå laget en informativ figur med ekte data, fra start til slutt.\n\n## Filtrere data\n\nHva om vi vil se nærmere på bare ungdomsgruppen? Da kan vi *filtrere* dataene med funksjonen `filter()`, som velger ut rader som oppfyller et krav:\n\n\n\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Velg ut bare aldersgruppen 10-18 år\n# %>% (pipe) sender dataene videre til neste operasjon\n# filter() beholder rader der kravet er oppfylt\n# & betyr \"og\" -- begge krav må være oppfylt\nkrim_ung <- krim %>%\n  filter(alder > 10 & alder < 18)\n\n# Lag en rask figur av ungdomsgruppen\nggplot(krim_ung, aes(x = alder, y = vold)) +\n  geom_line() +\n  geom_point() +\n  ggtitle(\"Voldslovbrudd blant ungdom\") +\n  labs(x = \"Alder\", y = \"Siktede per 1000 innbyggere\") +\n  theme_minimal()\n```\n\n::: {.cell-output-display}\n![](forste_analyse_files/figure-epub/unnamed-chunk-12-1.png)\n:::\n:::\n\n\n\n\n\n\n\n\nHer bruker vi `%>%` (pipe-operatoren) som betyr \"ta dette, og gjør deretter\". Vi tar `krim`, sender det til `filter()`, og beholder bare rader der alder er mellom 10 og 18. Resultatet lagres i et nytt objekt `krim_ung`.\n\nFiguren viser den bratte økningen i ungdomsårene enda tydeligere. Pipen (`%>%`) og `filter()` er grunnleggende verktøy i tidyverse som dekkes grundig i Del III.\n\n## Større datasett med flere variable\n\nLa oss nå jobbe med et større datasett fra samme SSB-tabell, men med mer detalj: fordelt på type lovbrudd, kjønn og år. Denne Excel-filen er litt mer komplisert -- de tre første radene inneholder overskriftstekst fra SSB som ikke er data, og kolonnene har ikke gode variabelnavn:\n\n\n\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Lese inn et større datasett\n# skip = 3 hopper over de 3 første radene (overskriftstekst fra SSB)\n# col_names angir variabelnavn vi velger selv\n# Vi bruker variabelnavn uten æøå for å unngå tegnkodingsproblemer\nkrim_alle <- read_excel(\"data/SSB_09415_alderSiktet.xlsx\",\n                         skip = 3,\n                         col_names = c(\"lovbruddsgruppe\", \"kjonn\",\n                                       \"alder\", \"aar\", \"pr1000\"))\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\n# Se på de første radene\nhead(krim_alle)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n# A tibble: 6 × 5\n  lovbruddsgruppe       kjonn       alder aar   pr1000\n  <chr>                 <chr>       <dbl> <chr>  <dbl>\n1 Alle lovbruddsgrupper Begge kjønn     5 2002    0.26\n2 Alle lovbruddsgrupper Begge kjønn     5 2003    0.27\n3 Alle lovbruddsgrupper Begge kjønn     5 2004    0.13\n4 Alle lovbruddsgrupper Begge kjønn     5 2005    0.12\n5 Alle lovbruddsgrupper Begge kjønn     5 2006    0.1 \n6 Alle lovbruddsgrupper Begge kjønn     5 2007    0.07\n```\n\n\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\n# Se hvilke lovbruddsgrupper som finnes\n# table() teller opp hvor mange ganger hver verdi forekommer\ntable(krim_alle$lovbruddsgruppe)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n\n          Alle lovbruddsgrupper                  Annet lovbrudd \n                           3174                            3174 \n         Annet vinningslovbrudd                   Eiendomsskade \n                           3174                            3174 \n                 Eiendomstyveri Ordens- og integritetskrenkelse \n                           3174                            3174 \n              Rusmiddellovbrudd                 Seksuallovbrudd \n                           3174                            3174 \n            Trafikkovertredelse             Vold og mishandling \n                           3174                            3174 \n```\n\n\n:::\n:::\n\n\n\n\n\n\n\n\nVi ser at datasettet inneholder flere lovbruddsgrupper. `$`-tegnet brukes for å hente ut én enkelt variabel fra datasettet. La oss filtrere til bare voldskriminalitet:\n\n\n\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Velg ut bare voldskriminalitet for begge kjønn\nkrim_vold <- krim_alle %>%\n  filter(lovbruddsgruppe == \"Vold og mishandling\",\n         kjonn == \"Begge kjønn\")\n```\n:::\n\n\n\n\n\n\n\n\n## Figur med flere grupper\n\nNå har vi data for voldskriminalitet over flere år. La oss bygge opp en figur steg for steg igjen.\n\n### Steg 1: Enkel linje -- noe er galt\n\n\n\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Prøv å tegne en enkel linje -- dette blir rotete!\nggplot(krim_vold, aes(x = alder, y = pr1000)) +\n  geom_line()\n```\n\n::: {.cell-output-display}\n![](forste_analyse_files/figure-epub/unnamed-chunk-17-1.png)\n:::\n:::\n\n\n\n\n\n\n\n\nDenne figuren ser kaotisk ut. Det er fordi ggplot prøver å tegne alle datapunktene -- fra alle år -- som én sammenhengende linje. Vi må fortelle ggplot at hvert år er en egen gruppe.\n\n### Steg 2: Gruppering og farge\n\n\n\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# group = aar gjør at hvert år får sin egen linje\n# color = aar gir ulike farger for hvert år\nggplot(krim_vold, aes(x = alder, y = pr1000, group = aar, color = aar)) +\n  geom_line()\n```\n\n::: {.cell-output-display}\n![](forste_analyse_files/figure-epub/unnamed-chunk-18-1.png)\n:::\n:::\n\n\n\n\n\n\n\n\nNå er det mye bedre. `group = aar` forteller ggplot at datapunktene skal deles inn etter år, og `color = aar` gir hver gruppe en egen farge. Vi ser alderskurven for voldskriminalitet for hvert år.\n\n### Steg 3: Titler og tema\n\n\n\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Legg til titler og renere tema\nggplot(krim_vold, aes(x = alder, y = pr1000, group = aar, color = aar)) +\n  geom_line() +\n  ggtitle(\"Voldslovbrudd etter alder og år\") +\n  labs(x = \"Alder\",\n       y = \"Siktede per 1000 innbyggere\",\n       color = \"År\") +\n  theme_minimal()\n```\n\n::: {.cell-output-display}\n![](forste_analyse_files/figure-epub/unnamed-chunk-19-1.png)\n:::\n:::\n\n\n\n\n\n\n\n\nSamme prinsipp som før: vi legger til lag for tittel, akselabels og tema. `color = \"År\"` i `labs()` endrer etiketten på fargelegenden.\n\n## Avgrense ytterligere\n\nFiguren ovenfor har mange linjer og kan være vanskelig å lese. La oss avgrense til ungdom og velge ut bare noen utvalgte år:\n\n\n\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Avgrense til alder 10-18 og hvert tredje år fra 2002 til 2024\n# %in% sjekker om en verdi finnes i en liste\n# seq() lager en tallrekke: 2002, 2005, 2008, ..., 2024\nkrim_utvalg <- krim_vold %>%\n  filter(alder > 10, alder < 18) %>%\n  filter(aar %in% seq(2002, 2024, by = 3))\n\n# Figur med tykkere linjer og punkter\nggplot(krim_utvalg, aes(x = alder, y = pr1000, group = aar, color = aar)) +\n  geom_line(linewidth = 1) +\n  geom_point() +\n  ggtitle(\"Voldslovbrudd blant ungdom, utvalgte år\") +\n  labs(x = \"Alder\",\n       y = \"Siktede per 1000 innbyggere\",\n       color = \"År\") +\n  theme_minimal()\n```\n\n::: {.cell-output-display}\n![](forste_analyse_files/figure-epub/unnamed-chunk-20-1.png)\n:::\n:::\n\n\n\n\n\n\n\n\nHer kombinerer vi flere filtreringer: først avgrenser vi til ungdom, deretter velger vi ut hvert tredje år. `seq(2002, 2024, by = 3)` lager tallrekken 2002, 2005, 2008, ..., 2024, og `%in%` sjekker om verdien av `aar` finnes i denne listen.\n\nFiguren blir mye lettere å lese, og mønsteret er tydelig: vi kan se hvordan ungdomskriminaliteten har utviklet seg over tid.\n\n## Tidstrend for utvalgte aldersgrupper\n\nTil nå har vi hatt alder på x-aksen og brukt farger for å skille mellom år. Vi kan også snu perspektivet: sette *år* på x-aksen og bruke farger for å skille mellom *aldersgrupper*. Da ser vi tidstrenden -- hvordan kriminaliteten har utviklet seg over tid for ulike aldersgrupper.\n\n\n\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Velg ut noen utvalgte aldersgrupper\n# factor() gjør alder om til en kategori slik at fargene blir diskrete\nkrim_alder <- krim_vold %>%\n  filter(alder %in% c(12, 14, 15, 18, 25, 30)) %>%\n  mutate(alder = factor(alder))\n\n# Tidstrend: år på x-aksen, en linje per aldersgruppe\nggplot(krim_alder, aes(x = aar, y = pr1000, group = alder, color = alder)) +\n  geom_line(linewidth = 1) +\n  geom_point() +\n  ggtitle(\"Tidstrend i voldslovbrudd for utvalgte aldersgrupper\") +\n  labs(x = \"År\",\n       y = \"Siktede per 1000 innbyggere\",\n       color = \"Alder\") +\n  theme_minimal()\n```\n\n::: {.cell-output-display}\n![](forste_analyse_files/figure-epub/unnamed-chunk-21-1.png)\n:::\n:::\n\n\n\n\n\n\n\n\nLegg merke til at koden er nesten identisk med den forrige figuren -- vi har bare byttet hva som er på x-aksen (`aar` i stedet for `alder`) og hva som styrer fargene (`alder` i stedet for `aar`). `factor(alder)` gjør at alder behandles som en kategori med diskrete farger i stedet for en sammenhengende skala.\n\nFiguren viser at utviklingen er svært ulik for ulike aldersgrupper. 18-åringene har det høyeste nivået, men alle aldersgrupper kan studeres over tid. Med noen få endringer i koden har vi et helt annet perspektiv på de samme dataene.\n\n## Oppsummering\n\nI dette kapittelet har du gjennomført en hel analyse fra start til mål:\n\n1.  Lastet pakker med `library()`\n2.  Lest inn data fra en Excel-fil med `read_excel()`\n3.  Utforsket dataene med `head()`, `glimpse()` og `table()`\n4.  Laget figurer med `ggplot()`, `geom_line()` og `geom_point()`\n5.  Lagt til titler og etiketter med `ggtitle()` og `labs()`\n6.  Endret utseende med `theme_minimal()`\n7.  Filtrert data med `filter()` og pipen `%>%`\n\nAlt dette er verktøy du vil bruke gjennom hele boken. Hvert tema dekkes grundig i sine egne kapitler: innlesning av data i Del II, datahåndtering med tidyverse i Del III, og grafikk med ggplot i Del IV.\n\nHvis det er noe du ikke helt forsto -- det er helt normalt. Poenget nå var å se at R fungerer, at du kan produsere noe meningsfullt med noen få linjer kode, og at den lagvise oppbyggingen av figurer gir deg full kontroll over resultatet.\n\n## Oppgaver\n\n::: {#exr-forste1}\nKjør all koden i dette kapittelet selv i RStudio. Gjør noen endringer og kjør på nytt -- for eksempel, prøv å endre tittelen på en figur, legg til `geom_point(color = \"red\")` i stedet for `geom_point()`, eller filtrer på en annen aldersgruppe. Målet er at du skal se at endringene dine faktisk fungerer.\n:::\n\n::: {#exr-forste2}\nFiltrer `krim_alle` på en annen lovbruddsgruppe enn \"Vold og mishandling\". Bruk `table(krim_alle$lovbruddsgruppe)` for å se hvilke grupper som finnes. Lag en figur tilsvarende den vi lagde for voldskriminalitet.\n:::\n",
    "supporting": [
      "forste_analyse_files\\figure-epub"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {
      "knitr": [
        "{\"type\":\"list\",\"attributes\":{},\"value\":[]}"
      ]
    },
    "preserve": null,
    "postProcess": false
  }
}