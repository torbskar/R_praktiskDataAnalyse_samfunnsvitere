{
  "hash": "08e0aa27104c66400762cd416ac30166",
  "result": {
    "engine": "knitr",
    "markdown": "# Nettverksanalyse\n\n\n\n\n\n\n\n\n::: {.cell}\n\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(tidyverse)\nlibrary(igraph)\n```\n:::\n\n\n\n\n\n\n\n\nNettverksanalyse handler om relasjoner mellom enheter. Mens vi i regresjonsanalyse fokuserer på egenskaper ved individer (f.eks. alder, inntekt, utdanning), fokuserer nettverksanalyse på *forbindelsene* mellom dem. Hvem kjenner hvem? Hvem samarbeider med hvem? Hvilke organisasjoner har overlappende styremedlemmer? Dette er typiske sporsmal som nettverksanalyse kan belyse.\n\n## Hva er et nettverk?\n\nEt nettverk bestar av to grunnleggende byggeklosser: *noder* og *kanter*. Nodene er enhetene i nettverket (f.eks. personer, organisasjoner, land), mens kantene er forbindelsene mellom dem (f.eks. vennskap, handelsrelasjoner, kommunikasjon).\n\nI samfunnsvitenskap er vi ofte interessert i *sosiale nettverk*, der nodene er personer og kantene representerer en eller annen form for relasjon. Men nettverksanalyse brukes ogsa pa mange andre typer data.\n\n\n## Typer nettverk\n\nDet finnes ulike typer nettverk, og det er viktig a vite hvilken type man jobber med:\n\n- **Urettet nettverk**: Kantene gar begge veier. Vennskap er et typisk eksempel: hvis A er venn med B, sa er B venn med A.\n- **Rettet nettverk**: Kantene har en retning. Twitter-folging er et eksempel: A kan folge B uten at B folger A tilbake.\n- **Vektet nettverk**: Kantene har en styrke. F.eks. kan man vekte etter hvor mange ganger to personer har kommunisert.\n\n\n## Lage nettverksobjekter med igraph\n\nPakken `igraph` er det mest brukte verktøyet for nettverksanalyse i R. La oss starte med a lage et lite eksempelnettverk. Tenk deg en liten vennegjeng:\n\n\n\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nvenner <- graph_from_literal(Anna -- Bjorn,\n                             Anna -- Cecilie,\n                             Bjorn -- Cecilie,\n                             Bjorn -- David,\n                             Cecilie -- Elin,\n                             David -- Elin,\n                             David -- Fredrik)\nvenner\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nIGRAPH 286f88e UN-- 6 7 -- \n+ attr: name (v/c)\n+ edges from 286f88e (vertex names):\n[1] Anna   --Bjorn   Anna   --Cecilie Bjorn  --Cecilie Bjorn  --David  \n[5] Cecilie--Elin    David  --Elin    David  --Fredrik\n```\n\n\n:::\n:::\n\n\n\n\n\n\n\n\nHer har vi laget et urettet nettverk med seks personer og syv relasjoner. Dobbel bindestrek `--` betyr urettet kant. Hadde vi brukt `+-+` ville det blitt rettet.\n\nVi kan plotte dette med en gang:\n\n\n\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nplot(venner,\n     vertex.color = \"lightblue\",\n     vertex.size = 30,\n     vertex.label.cex = 0.9,\n     edge.color = \"gray50\",\n     main = \"Vennenettverket\")\n```\n\n::: {.cell-output-display}\n![](nettverksanalyse_files/figure-epub/unnamed-chunk-4-1.png)\n:::\n:::\n\n\n\n\n\n\n\n\n\n## Kantlister og nabomatriser\n\nI praksis lager man sjelden nettverk for hand slik som ovenfor. Data kommer ofte som en *kantliste* (edge list), som er en tabell med to kolonner: fra-node og til-node. Hver rad representerer en forbindelse mellom to noder.\n\nLa oss lese inn det samme vennenettverket fra en CSV-fil:\n\n\n\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nkantliste <- read_csv(\"data/venner_kantliste.csv\")\n```\n:::\n\n\n\n\n\n\n\n\nLa oss se pa datastrukturen:\n\n\n\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nkantliste\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n# A tibble: 7 × 2\n  fra     til    \n  <chr>   <chr>  \n1 Anna    Bjorn  \n2 Anna    Cecilie\n3 Bjorn   Cecilie\n4 Bjorn   David  \n5 Cecilie Elin   \n6 David   Elin   \n7 David   Fredrik\n```\n\n\n:::\n:::\n\n\n\n\n\n\n\n\nKantlisten er en helt vanlig tabell med to kolonner: `fra` og `til`. Hver rad er en kant i nettverket. Dette er den vanligste maten a lagre nettverksdata pa, og formatet er lett a lage i Excel eller eksportere fra andre systemer.\n\nFra en slik kantliste kan vi lage et nettverksobjekt:\n\n\n\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\ng <- graph_from_data_frame(kantliste, directed = FALSE)\nplot(g,\n     vertex.color = \"lightblue\",\n     vertex.size = 30,\n     vertex.label.cex = 0.9)\n```\n\n::: {.cell-output-display}\n![](nettverksanalyse_files/figure-epub/unnamed-chunk-7-1.png)\n:::\n:::\n\n\n\n\n\n\n\n\nEn annen vanlig representasjon er en *nabomatrise* (adjacency matrix), der radene og kolonnene er noder, og cellene angir om det er en kant mellom dem (1) eller ikke (0):\n\n\n\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nas_adjacency_matrix(g, sparse = FALSE)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n        Anna Bjorn Cecilie David Elin Fredrik\nAnna       0     1       1     0    0       0\nBjorn      1     0       1     1    0       0\nCecilie    1     1       0     0    1       0\nDavid      0     1       0     0    1       1\nElin       0     0       1     1    0       0\nFredrik    0     0       0     1    0       0\n```\n\n\n:::\n:::\n\n\n\n\n\n\n\n\nNabomatrisen er symmetrisk fordi nettverket er urettet. For rettede nettverk ville matrisen typisk ikke vaert symmetrisk.\n\n\n## Nettverksmaal\n\nNettverksanalyse tilbyr en rekke mal for a beskrive bade hele nettverket og enkeltnoders posisjon. Her ser vi pa tre av de mest sentrale:\n\n### Grad (degree)\nGrad er det enkleste malet: hvor mange kanter har en node? I et vennskapsnettverk betyr det rett og slett hvor mange venner en person har.\n\n\n\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\ndegree(g)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n   Anna   Bjorn Cecilie   David    Elin Fredrik \n      2       3       3       3       2       1 \n```\n\n\n:::\n:::\n\n\n\n\n\n\n\n\nBjorn og David har flest forbindelser, mens Fredrik bare har en.\n\n\n### Mellomleddsentralitet (betweenness)\nMellomleddsentralitet maler hvor ofte en node ligger pa den korteste veien mellom andre noder. En person med hay mellomleddsentralitet fungerer som en *bro* i nettverket.\n\n\n\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nbetweenness(g)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n   Anna   Bjorn Cecilie   David    Elin Fredrik \n    0.0     3.0     1.5     4.5     1.0     0.0 \n```\n\n\n:::\n:::\n\n\n\n\n\n\n\n\n### Naerhetssentralitet (closeness)\nNaerhetssentralitet maler hvor naer en node er alle andre noder i nettverket. En person med hay naerhetssentralitet kan na alle andre raskt.\n\n\n\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\ncloseness(g)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n      Anna      Bjorn    Cecilie      David       Elin    Fredrik \n0.11111111 0.14285714 0.12500000 0.14285714 0.12500000 0.09090909 \n```\n\n\n:::\n:::\n\n\n\n\n\n\n\n\nLa oss samle disse malene i en tabell:\n\n\n\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nsentralitet <- tibble(\n  navn = V(g)$name,\n  grad = degree(g),\n  mellomled = round(betweenness(g), 1),\n  naerhet = round(closeness(g), 3)\n)\nsentralitet\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n# A tibble: 6 × 4\n  navn     grad mellomled naerhet\n  <chr>   <dbl>     <dbl>   <dbl>\n1 Anna        2       0     0.111\n2 Bjorn       3       3     0.143\n3 Cecilie     3       1.5   0.125\n4 David       3       4.5   0.143\n5 Elin        2       1     0.125\n6 Fredrik     1       0     0.091\n```\n\n\n:::\n:::\n\n\n\n\n\n\n\n\nVi ser at Bjorn og David skiller seg ut som de mest sentrale personene i dette nettverket, uansett hvilket mal vi bruker.\n\n\n## Visualisering med ggraph\n\nFor finere grafisk kontroll kan vi bruke pakken `ggraph`, som bygger pa ggplot-logikken:\n\n\n\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(ggraph)\n\nggraph(g, layout = \"fr\") +\n  geom_edge_link(color = \"gray60\") +\n  geom_node_point(size = 8, color = \"steelblue\") +\n  geom_node_text(aes(label = name), repel = TRUE, size = 4) +\n  theme_void() +\n  ggtitle(\"Vennenettverket med ggraph\")\n```\n\n::: {.cell-output-display}\n![](nettverksanalyse_files/figure-epub/unnamed-chunk-13-1.png)\n:::\n:::\n\n\n\n\n\n\n\n\nHer bruker vi Fruchterman-Reingold-algoritmen (`layout = \"fr\"`) for a plassere nodene. `geom_edge_link()` tegner kantene, `geom_node_point()` tegner nodene, og `geom_node_text()` legger pa navnene. Merk at dette folger ggplot-logikken med lag oppå lag.\n\nVi kan ogsa la nodestorrelsen reflektere grad:\n\n\n\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nggraph(g, layout = \"fr\") +\n  geom_edge_link(color = \"gray60\") +\n  geom_node_point(aes(size = degree(g)), color = \"steelblue\") +\n  geom_node_text(aes(label = name), repel = TRUE, size = 4) +\n  scale_size_continuous(range = c(4, 12), name = \"Grad\") +\n  theme_void()\n```\n\n::: {.cell-output-display}\n![](nettverksanalyse_files/figure-epub/unnamed-chunk-14-1.png)\n:::\n:::\n\n\n\n\n\n\n\n\n\n## Samfunnsdeteksjon\n\nEn vanlig oppgave i nettverksanalyse er a identifisere *grupper* (communities/klynger) av noder som er tettere knyttet til hverandre enn til resten av nettverket. Det finnes flere algoritmer for dette. Her bruker vi en enkel metode:\n\n\n\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\ngrupper <- cluster_walktrap(g)\nmembership(grupper)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n   Anna   Bjorn Cecilie   David    Elin Fredrik \n      2       2       2       1       1       1 \n```\n\n\n:::\n:::\n\n\n\n\n\n\n\n\nVi kan fargelegge nettverket etter gruppemedlemskap:\n\n\n\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nplot(grupper, g,\n     vertex.size = 30,\n     vertex.label.cex = 0.9,\n     main = \"Grupper i vennenettverket\")\n```\n\n::: {.cell-output-display}\n![](nettverksanalyse_files/figure-epub/unnamed-chunk-16-1.png)\n:::\n:::\n\n\n\n\n\n\n\n\n\n## Praktisk eksempel: samarbeidsnettverk\n\nTenk deg et forskningssamarbeid mellom ansatte pa et institutt. Vi leser inn en kantliste der hver rad er et samarbeid mellom to forskere, og kolonnen `antall_artikler` angir hvor mange felles artikler de har:\n\n\n\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nsamarbeid <- read_csv(\"data/samarbeid_kantliste.csv\")\n```\n:::\n\n\n\n\n\n\n\n\nLa oss se pa datastrukturen:\n\n\n\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nsamarbeid\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n# A tibble: 11 × 3\n   forsker1 forsker2 antall_artikler\n   <chr>    <chr>              <dbl>\n 1 Ola      Kari                   5\n 2 Ola      Per                    2\n 3 Kari     Liv                    3\n 4 Kari     Mona                   1\n 5 Per      Jan                    4\n 6 Liv      Jan                    6\n 7 Liv      Mona                   2\n 8 Liv      Ola                    1\n 9 Jan      Mona                   3\n10 Jan      Ola                    1\n11 Mona     Per                    1\n```\n\n\n:::\n:::\n\n\n\n\n\n\n\n\nDenne kantlisten har tre kolonner: `forsker1` og `forsker2` angir hvem som samarbeider, mens `antall_artikler` er en vekt som sier noe om styrken pa relasjonen. Slike vektede kantlister er svart vanlige i praksis.\n\nNa kan vi lage et nettverksobjekt og bruke vektene:\n\n\n\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\ng2 <- graph_from_data_frame(samarbeid, directed = FALSE)\nE(g2)$weight <- samarbeid$antall_artikler\n\nggraph(g2, layout = \"fr\") +\n  geom_edge_link(aes(width = weight), alpha = 0.6, color = \"gray40\") +\n  geom_node_point(aes(size = degree(g2)), color = \"tomato\") +\n  geom_node_text(aes(label = name), repel = TRUE, size = 4) +\n  scale_edge_width_continuous(range = c(0.5, 3), name = \"Artikler\") +\n  scale_size_continuous(range = c(4, 12), name = \"Grad\") +\n  theme_void() +\n  ggtitle(\"Samarbeidsnettverk\")\n```\n\n::: {.cell-output-display}\n![](nettverksanalyse_files/figure-epub/unnamed-chunk-19-1.png)\n:::\n:::\n\n\n\n\n\n\n\n\nHer ser vi at kanttykkelsen viser antall felles artikler, mens nodestorrelsen viser antall samarbeidspartnere. Liv og Jan ser ut til a vaere sentrale i dette nettverket.\n\n\n## Nar er nettverksanalyse nyttig?\n\nNettverksanalyse er et godt valg nar:\n\n- Du er interessert i *relasjoner* mellom enheter, ikke bare egenskaper ved enhetene selv.\n- Du vil identifisere sentrale aktorer i et nettverk (f.eks. nøkkelpersoner i en organisasjon).\n- Du vil forstå hvordan informasjon eller innflytelse sprer seg.\n- Du vil finne grupper eller klynger i data.\n- Du vil studere strukturen i et sosialt system.\n\nNettverksanalyse er mye brukt i sosiologi, statsvitenskap, kriminologi, folkehelse og mange andre fagfelt. Det er et kraftig verktoy for a forstå sosiale strukturer som ikke lar seg fange med tradisjonelle regresjonsmodeller.\n",
    "supporting": [
      "nettverksanalyse_files\\figure-epub"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {
      "knitr": [
        "{\"type\":\"list\",\"attributes\":{},\"value\":[]}"
      ]
    },
    "preserve": null,
    "postProcess": false
  }
}